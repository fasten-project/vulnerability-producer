/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package eu.fasten.vulnerabilityproducer.utils.mappers;

import com.fasterxml.jackson.annotation.JsonProperty;

import java.util.List;

/**
 * This class is designed to map instances of Github Advisories
 * More information will follow soon
 */
public class JSONHandler {
    public static class GHResponse {
        public GHData data;

        public GHResponse() {
        }

        public GHData getData() {
            return data;
        }

        public void setData(GHData data) {
            this.data = data;
        }
    }

    public static class GHData {
        public GHSecurityAdvisory securityAdvisories;

        public GHData() {
        }

        public GHSecurityAdvisory getSecurityAdvisories() {
            return securityAdvisories;
        }

        public void setSecurityAdvisories(GHSecurityAdvisory securityAdvisories) {
            this.securityAdvisories = securityAdvisories;
        }
    }

    public static class GHSecurityAdvisory {
        public List<GHAdvisory> nodes;
        public GHPageInfo pageInfo;

        public GHSecurityAdvisory() {
        }

        public List<GHAdvisory> getNodes() {
            return nodes;
        }

        public void setNodes(List<GHAdvisory> nodes) {
            this.nodes = nodes;
        }

        public GHPageInfo getPageInfo() {
            return pageInfo;
        }

        public void setPageInfo(GHPageInfo pageInfo) {
            this.pageInfo = pageInfo;
        }
    }

    public static class GHPageInfo {
        public String endCursor;
        public boolean hasNextPage;
    }

    public static class GHAdvisory {
        public String description;
        public String withdrawnAt;
        public List<GHIdentifiers> identifiers;
        public Severity severity;
        public GHCVSS cvss;
        public GHCWE cwes;
        public List<GHReference> references;
        public GHVulnerabilities vulnerabilities;

        public GHAdvisory() {
        }

        public String getDescription() {
            return description;
        }

        public void setDescription(String description) {
            this.description = description;
        }

        public String getWithdrawnAt() { return withdrawnAt; }

        public void setWithdrawnAt(String withdrawnAt ) { this.withdrawnAt = withdrawnAt; }

        public List<GHIdentifiers> getIdentifiers() {
            return identifiers;
        }

        public void setIdentifiers(List<GHIdentifiers> identifiers) {
            this.identifiers = identifiers;
        }

        public Severity getSeverity() {
            return severity;
        }

        public void setSeverity(Severity severity) {
            this.severity = severity;
        }

        public List<GHReference> getReferences() {
            return references;
        }

        public void setReferences(List<GHReference> references) {
            this.references = references;
        }

        public GHVulnerabilities getVulnerabilities() {
            return vulnerabilities;
        }

        public void setVulnerabilities(GHVulnerabilities vulnerabilities) {
            this.vulnerabilities = vulnerabilities;
        }

        public GHCVSS getCvss() {
            return cvss;
        }

        public void setCvss(GHCVSS cvss) {
            this.cvss = cvss;
        }

        public GHCWE getCwes() {
            return cwes;
        }

        public void setCwes(GHCWE cwes) {
            this.cwes = cwes;
        }

        /**
         * Helper method to get the id of the vulnerability.
         * Looks for the CVE id and otherwise defaults to the first it gets
         *
         * @return id e.g. CVE-2012-6733 or GHSA-m6cx-g6qm-p2cx
         */
        public String getAdvisoryId() {
            for (GHIdentifiers identifier : identifiers) {
                if (identifier.type.equals("CVE")) {
                    return identifier.value;
                }
            }
            return identifiers.get(0).getValue();
        }
    }

    public static class GHIdentifiers {
        public String type;
        public String value;

        public GHIdentifiers() {
        }

        public String getType() {
            return type;
        }

        public void setType(String type) {
            this.type = type;
        }

        public String getValue() {
            return value;
        }

        public void setValue(String value) {
            this.value = value;
        }
    }

    public static class GHReference {
        public String url;

        public GHReference() {
        }

        public String getUrl() {
            return url;
        }

        public void setUrl(String url) {
            this.url = url;
        }
    }

    public static class GHVulnerabilities {
        public List<GHNodes> nodes;

        public GHVulnerabilities() {
        }

        public List<GHNodes> getNodes() {
            return nodes;
        }

        public void setNodes(List<GHNodes> nodes) {
            this.nodes = nodes;
        }
    }

    public static class GHNodes {
        public String vulnerableVersionRange;
        @JsonProperty("package")
        public GHPackage ghPackage;
        public GHFirstPatched firstPatchedVersion;

        public GHNodes() {
        }

        public String getVulnerableVersionRange() {
            return vulnerableVersionRange;
        }

        public void setVulnerableVersionRange(String vulnerableVersionRange) {
            this.vulnerableVersionRange = vulnerableVersionRange;
        }

        public GHPackage getGhPackage() {
            return ghPackage;
        }

        public void setGhPackage(GHPackage ghPackage) {
            this.ghPackage = ghPackage;
        }
    }

    public static class GHPackage {
        public String ecosystem;
        public String name;

        public GHPackage() {
        }

        public String getEcosystem() {
            return ecosystem;
        }

        public void setEcosystem(String ecosystem) {
            this.ecosystem = ecosystem;
        }

        public String getName() {
            return name;
        }

        public void setName(String name) {
            this.name = name;
        }
    }

    public static class GHFirstPatched {
        public String identifier;

        public GHFirstPatched() {
        }

        public String getIdentifier() {
            return identifier;
        }

        public void setIdentifier(String identifier) {
            this.identifier = identifier;
        }
    }

    public static class GHCVSS {
        public Double score;
        public String vectorString;
        public GHCVSS() {}

        public Double getScore() {
            return score;
        }

        public void setScore(Double score) {
            this.score = score;
        }

        public String getVectorString() {
            return vectorString;
        }

        public void setVectorString(String vectorString) {
            this.vectorString = vectorString;
        }
    }

    public static class GHCWE {
        public List<GHCWENode> nodes;

        public GHCWE() {}

        public List<GHCWENode> getNodes() {
            return nodes;
        }

        public void setNodes(List<GHCWENode> nodes) {
            this.nodes = nodes;
        }
    }

    public static class GHCWENode {
        public String cweId;
        public GHCWENode() {}

        public String getCweId() {
            return cweId;
        }

        public void setCweId(String cweId) {
            this.cweId = cweId;
        }
    }
}
