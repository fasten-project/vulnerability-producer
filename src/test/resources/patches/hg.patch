
# HG changeset patch
# User fojtik
# Date 1509842128 -3600
# Node ID 135bdcb88b8d90995eb182ba1815e9f21f77e2f8
# Parent  fcd3ed3394f675a922f3b0f22de60004e1b342c4
Do not call SyncImagePixels() when something fails.

diff -r fcd3ed3394f6 -r 135bdcb88b8d coders/wpg.c
--- a/coders/wpg.c	Sun Nov 05 01:11:09 2017 +0100
+++ b/coders/wpg.c	Sun Nov 05 01:35:28 2017 +0100
@@ -340,12 +340,15 @@


   if(RetVal==MagickFail)
+  {
     (void) LogMagickEvent(CoderEvent,GetMagickModule(),"ImportImagePixelArea failed for row: %ld, bpp: %d", y, bpp);
+    return MagickFail;
+  }

-  if (!SyncImagePixels(image))
+  if(!SyncImagePixels(image))
   {
     (void) LogMagickEvent(CoderEvent,GetMagickModule(),"SyncImagePixels failed for row: %ld, bpp: %d", y, bpp);
-    RetVal = MagickFail;
+    return MagickFail;
   }

 return RetVal;
