{
  "sha": "443e8974d66a3ddd2ad89f8b3f9c2ebb7d8d9500",
  "node_id": "MDY6Q29tbWl0MTA4MTEwOjQ0M2U4OTc0ZDY2YTNkZGQyYWQ4OWY4YjNmOWMyZWJiN2Q4ZDk1MDA=",
  "commit": {
    "author": {
      "name": "Mathew Robinson",
      "email": "chasinglogic@gmail.com",
      "date": "2019-05-24T15:52:45Z"
    },
    "committer": {
      "name": "Mathew Robinson",
      "email": "chasinglogic@gmail.com",
      "date": "2019-05-31T17:46:18Z"
    },
    "message": "SERVER-40563 validate that `(${procname})` is the process' command name.",
    "tree": {
      "sha": "e78f2a539dc40a0720dd425bd9e9cf46e54f384d",
      "url": "https://api.github.com/repos/mongodb/mongo/git/trees/e78f2a539dc40a0720dd425bd9e9cf46e54f384d"
    },
    "url": "https://api.github.com/repos/mongodb/mongo/git/commits/443e8974d66a3ddd2ad89f8b3f9c2ebb7d8d9500",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/mongodb/mongo/commits/443e8974d66a3ddd2ad89f8b3f9c2ebb7d8d9500",
  "html_url": "https://github.com/mongodb/mongo/commit/443e8974d66a3ddd2ad89f8b3f9c2ebb7d8d9500",
  "comments_url": "https://api.github.com/repos/mongodb/mongo/commits/443e8974d66a3ddd2ad89f8b3f9c2ebb7d8d9500/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "4a02896895e37f8b576d0bb911606cd4738eb166",
      "url": "https://api.github.com/repos/mongodb/mongo/commits/4a02896895e37f8b576d0bb911606cd4738eb166",
      "html_url": "https://github.com/mongodb/mongo/commit/4a02896895e37f8b576d0bb911606cd4738eb166"
    }
  ],
  "stats": {
    "total": 24,
    "additions": 22,
    "deletions": 2
  },
  "files": [
    {
      "sha": "b4f5a662a9e5c8c6ab5f8cbad682de57d420daa9",
      "filename": "rpm/init.d-mongod",
      "status": "modified",
      "additions": 22,
      "deletions": 2,
      "changes": 24,
      "blob_url": "https://github.com/mongodb/mongo/blob/443e8974d66a3ddd2ad89f8b3f9c2ebb7d8d9500/rpm/init.d-mongod",
      "raw_url": "https://github.com/mongodb/mongo/raw/443e8974d66a3ddd2ad89f8b3f9c2ebb7d8d9500/rpm/init.d-mongod",
      "contents_url": "https://api.github.com/repos/mongodb/mongo/contents/rpm/init.d-mongod?ref=443e8974d66a3ddd2ad89f8b3f9c2ebb7d8d9500",
      "patch": "@@ -100,15 +100,35 @@ mongo_killproc()\n   local -i duration=10\n   local pid=`pidofproc -p \"${pid_file}\" ${procname}`\n \n-  kill -TERM $pid >/dev/null 2>&1\n+  # Per the man page the process name should always be the second\n+  # field. In our case mongod is wrapped in parens hence the parens in\n+  # the if condition below.\n+  local stat_procname=`cat /proc/$pid/stat | cut -d\" \" -f2`\n+  # $procname is the full path to the mongod binary but the process\n+  # name will only match the binary's file name.\n+  local binary_name=`basename $procname`\n+  if [ \"($binary_name)\" != \"$stat_procname\" ]; then\n+     echo \"PID file may have been tampered with, refusing to kill process\"\n+     echo \"Expected (${binary_name}) but found ${stat_procname}\"\n+     exit 1\n+  fi\n+\n+  # This doesn't actually \"daemonize\" this process. All this function\n+  # does (defined in /etc/init.d/function) is run a process as another\n+  # user in a way that doesn't require sudo or other packages which\n+  # are not guaranteed to exist on any given system.\n+  #\n+  # The check flag here can be ignored it doesn't do anything except\n+  # prevent the daemon function's PID checking from throwing an error.\n+  daemon --check \"$mongod\" --user \"$MONGO_USER\" \"kill -TERM $pid >/dev/null 2>&1\"\n   usleep 100000\n   local -i x=0\n   while [ $x -le $delay ] && checkpid $pid; do\n     sleep $duration\n     x=$(( $x + $duration))\n   done\n \n-  kill -KILL $pid >/dev/null 2>&1\n+  daemon --check \"$mongod\" --user \"$MONGO_USER\" \"kill -KILL $pid >/dev/null 2>&1\"\n   usleep 100000\n \n   checkpid $pid # returns 0 only if the process exists"
    }
  ]
}