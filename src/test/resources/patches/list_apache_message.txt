From hdfs-dev-return-38812-archive-asf-public=cust-asf.ponee.io@hadoop.apache.org  Mon Oct  7 01:51:14 2019
Return-Path: <hdfs-dev-return-38812-archive-asf-public=cust-asf.ponee.io@hadoop.apache.org>
X-Original-To: archive-asf-public@cust-asf.ponee.io
Delivered-To: archive-asf-public@cust-asf.ponee.io
Received: from mail.apache.org (hermes.apache.org [207.244.88.153])
	by mx-eu-01.ponee.io (Postfix) with SMTP id 4A7D9180667
	for <archive-asf-public@cust-asf.ponee.io>; Mon,  7 Oct 2019 03:51:14 +0200 (CEST)
Received: (qmail 20744 invoked by uid 500); 7 Oct 2019 01:51:11 -0000
Mailing-List: contact hdfs-dev-help@hadoop.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:hdfs-dev-help@hadoop.apache.org>
List-Unsubscribe: <mailto:hdfs-dev-unsubscribe@hadoop.apache.org>
List-Post: <mailto:hdfs-dev@hadoop.apache.org>
List-Id: <hdfs-dev.hadoop.apache.org>
Delivered-To: mailing list hdfs-dev@hadoop.apache.org
Received: (qmail 20720 invoked by uid 99); 7 Oct 2019 01:51:09 -0000
Received: from Unknown (HELO mailrelay1-lw-us.apache.org) (10.10.3.42)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 07 Oct 2019 01:51:09 +0000
Received: from mail-lj1-f169.google.com (mail-lj1-f169.google.com [209.85.208.169])
	by mailrelay1-lw-us.apache.org (ASF Mail Server at mailrelay1-lw-us.apache.org) with ESMTPSA id 950BC7949;
	Mon,  7 Oct 2019 01:51:09 +0000 (UTC)
Received: by mail-lj1-f169.google.com with SMTP id m13so11813538ljj.11;
        Sun, 06 Oct 2019 18:51:09 -0700 (PDT)
X-Gm-Message-State: APjAAAXKAdIe+qakIcTOjv3qbAYLNw9scGmaIO9FaJv5Mr/3al4qPoUx
	LeJffeEwepWjDqn2bN21V63HiFS0ynbdBi0XsZw=
X-Google-Smtp-Source: APXvYqx3v7zstiC9uJkFQ+ZGmy+moomlZbcjbS7Sul3Cfv31/PcFTeEMiEsfU3OZwzJU32Ky9OYsftdEqAjjbPK2ng0=
X-Received: by 2002:a2e:9f03:: with SMTP id u3mr16545569ljk.140.1570413068365;
 Sun, 06 Oct 2019 18:51:08 -0700 (PDT)
MIME-Version: 1.0
References: <5D97565200EF07840039047F_0_38305@msllnjpmsgsv06> <CADiq6=wJXVCSjAp6MtEH9dsZEOL9cErkLkra3z9bfZUY_i9EZQ@mail.gmail.com>
In-Reply-To: <CADiq6=wJXVCSjAp6MtEH9dsZEOL9cErkLkra3z9bfZUY_i9EZQ@mail.gmail.com>
From: Akira Ajisaka <aajisaka@apache.org>
Date: Mon, 7 Oct 2019 10:50:00 +0900
X-Gmail-Original-Message-ID: <CAP+3qq6VeqANXj6BKDUDu8PEkOr0NrR9oCREgFpztcWDaumB4w@mail.gmail.com>
Message-ID: <CAP+3qq6VeqANXj6BKDUDu8PEkOr0NrR9oCREgFpztcWDaumB4w@mail.gmail.com>
Subject: Re: CVE-2018-11768: HDFS FSImage Corruption
To: Wei-Chiu Chuang <weichiu@apache.org>, Clay Baenziger <cbaenziger@bloomberg.net>
Cc: Hdfs-dev <hdfs-dev@hadoop.apache.org>,
	"<security@hadoop.apache.org>" <security@hadoop.apache.org>
Content-Type: multipart/alternative; boundary="0000000000001734c60594484926"

--0000000000001734c60594484926
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

Hi Clay and Wei-Chiu,

Before finalizing the fsimage, you can rollback to 2.7.x.
After finalizing the fsimage, you cannot downgrade to 2.7.x.

Downgrade and rollback are different in HDFS.
https://issues.apache.org/jira/browse/HDFS-8432

Regards,
Akira

On Sat, Oct 5, 2019 at 4:29 AM Wei-Chiu Chuang <weichiu@apache.org> wrote:

> Per Apache security vulnerability report policy
> https://www.apache.org/security/committers.html
> we do not make public JIRAs for vulnerability reports.
>
> The CVE itself has nothing to do with rollbacks. However, the fix itself
> changes fsimage format and you won't be able to rollback to a 2.7 version=
.
>
> On Fri, Oct 4, 2019 at 7:25 AM Clay Baenziger (BLOOMBERG/ 731 LEX) <
> cbaenziger@bloomberg.net> wrote:
>
>> -General@
>> +HDFS-dev@
>> Hi Akira,
>>
>> Thanks for pointing out this CVE before my users come asking. Would you
>> be able to point to a JIRA ticket describing this issue? I see a few[1]
>> which look to align roughly to the release but do not grok why they woul=
d
>> trigger a CVE[2]. Also is this CVE only to do with the inability of
>> rolling-back to a 2.7.x release?
>>
>> -Clay
>>
>> [1]: Tickets which seem to be similar:
>>
>> *HDFS-13314 - NameNode should optionally exit if it detects FsImage
>> corruption
>> *HDFS-13101 - Yet another fsimage corruption related to snapshot
>> *HDFS-13596 - NN restart fails after RollingUpgrade from 2.x to 3.x
>> *[2]: I am under the impression CVE's were to track security related
>> vulnerabilities?
>>
>> From: aajisaka@apache.org At: 10/03/19 21:30:33To:
>> general@hadoop.apache.org,  security@hadoop.apache.org
>> Subject: CVE-2018-11768: HDFS FSImage Corruption
>>
>> CVE-2018-11768: HDFS FSImage Corruption
>>
>>
>> Severity: Critical
>>
>>
>> Vendor: The Apache Software Foundation
>>
>>
>> Versions affected:
>>
>> 3.1.0 to 3.1.1, 3.0.0-alpha1 to 3.0.3, 2.9.0 to 2.9.1, 2.0.0-alpha to
>> 2.8.4
>>
>>
>> Description:
>>
>> There is a mismatch in the size of the fields used to store user/group
>> information between memory and disk representation. This causes the
>> user/group information to be corrupted across storing in fsimage and
>> reading back from fsimage.
>>
>>
>> Mitigation:
>>
>> Users should upgrade to Apache Hadoop 2.8.5, 2.9.2, 3.1.2 or upper. This
>> vulnerability fix contains a fsimage layout change, so once the image is
>> saved in the new layout format you cannot go back to a version that
>> doesn=E2=80=99t
>> support the newer layout. This means that once 2.7.x users upgraded to t=
he
>> fixed version, they cannot downgrade to 2.7.x because there is no fixed
>> version in 2.7.x. We suggest downgrade to 2.8.5 or upper version that
>> contains the vulnerability fix.
>>
>>
>> Credit:
>>
>> This issue was discovered by Ekanth Sethuramalingam.
>>
>>
>>

--0000000000001734c60594484926--